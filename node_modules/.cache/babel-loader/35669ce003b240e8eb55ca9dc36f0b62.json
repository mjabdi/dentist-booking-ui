{"ast":null,"code":"\"use strict\";\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\n  result[\"default\"] = mod;\n  return result;\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar react_1 = __importStar(require(\"react\"));\n\nvar useDynamicCallback_1 = __importDefault(require(\"../hooks/useDynamicCallback\"));\n\nvar Context_1 = __importDefault(require(\"./Context\"));\n\nexports.SquarePaymentForm = function (props) {\n  var _a = react_1.useState('loading'),\n      applePayState = _a[0],\n      setApplePayState = _a[1];\n\n  var _b = react_1.useState('loading'),\n      googlePayState = _b[0],\n      setGooglePayState = _b[1];\n\n  var _c = react_1.useState('loading'),\n      masterpassState = _c[0],\n      setMasterpassState = _c[1];\n\n  var _d = react_1.useState(''),\n      errorMessage = _d[0],\n      setErrorMessage = _d[1];\n\n  var _e = react_1.useState(false),\n      scriptLoaded = _e[0],\n      setScriptLoaded = _e[1];\n\n  var _f = react_1.useState(undefined),\n      paymentForm = _f[0],\n      setPaymentForm = _f[1];\n\n  var _g = react_1.useState(false),\n      formLoaded = _g[0],\n      setFormLoaded = _g[1];\n\n  function cardNonceResponseReceived(errors, nonce, cardData, billingContact, shippingContact, shippingOption) {\n    if (errors || !props.createVerificationDetails) {\n      props.cardNonceResponseReceived(errors, nonce, cardData, '', billingContact, shippingContact, shippingOption);\n      return;\n    }\n\n    paymentForm && paymentForm.verifyBuyer(nonce, props.createVerificationDetails(), function (err, result) {\n      props.cardNonceResponseReceived(err ? [err] : null, nonce, cardData, result ? result.token : undefined, billingContact, shippingContact, shippingOption);\n    });\n  }\n\n  var cardNonceResponseReceivedCallback = useDynamicCallback_1.default(cardNonceResponseReceived);\n\n  function createNonce() {\n    paymentForm && paymentForm.requestCardNonce();\n  }\n\n  function verifyBuyer(source, verificationDetails, callback) {\n    paymentForm && paymentForm.verifyBuyer(source, verificationDetails, callback);\n  }\n\n  function methodsSupported(methods) {\n    var keys = Object.keys(methods);\n\n    if (keys.includes('masterpass')) {\n      setMasterpassState(methods.masterpass === true ? 'ready' : 'unavailable');\n    }\n\n    if (keys.includes('applePay')) {\n      setApplePayState(methods.applePay === true ? 'ready' : 'unavailable');\n    }\n\n    if (keys.includes('googlePay')) {\n      setGooglePayState(methods.googlePay === true ? 'ready' : 'unavailable');\n    }\n\n    props.methodsSupported && props.methodsSupported(methods);\n  }\n\n  var paymentFormLoaded = function () {\n    setFormLoaded(true);\n    props.paymentFormLoaded && props.paymentFormLoaded();\n  };\n\n  function loadSqPaymentFormLibrary(onSuccess, onError) {\n    if (document.getElementById('sq-payment-form-script') && typeof SqPaymentForm === 'function') {\n      onSuccess && onSuccess();\n      return;\n    }\n\n    var script = document.createElement('script');\n    script.id = 'sq-payment-form-script';\n\n    if (props.sandbox) {\n      script.src = 'https://js.squareupsandbox.com/v2/paymentform';\n    } else {\n      script.src = 'https://js.squareup.com/v2/paymentform';\n    }\n\n    script.onload = function () {\n      onSuccess && onSuccess();\n    };\n\n    script.onerror = function () {\n      onError && onError();\n    };\n\n    document.body.appendChild(script);\n  }\n\n  function buildSqPaymentFormConfiguration(props) {\n    var config = {\n      apiWrapper: props.apiWrapper,\n      applicationId: props.applicationId,\n      autoBuild: false,\n      callbacks: {\n        cardNonceResponseReceived: props.cardNonceResponseReceived ? cardNonceResponseReceivedCallback : null,\n        createPaymentRequest: props.createPaymentRequest,\n        inputEventReceived: props.inputEventReceived,\n        methodsSupported: methodsSupported,\n        paymentFormLoaded: paymentFormLoaded,\n        shippingContactChanged: props.shippingContactChanged,\n        shippingOptionChanged: props.shippingOptionChanged,\n        unsupportedBrowserDetected: props.unsupportedBrowserDetected\n      },\n      locationId: props.locationId\n    };\n\n    if (document.getElementById(props.formId + \"-sq-card\")) {\n      config.card = {\n        elementId: props.formId + \"-sq-card\",\n        inputStyle: props.inputStyles && props.inputStyles[0]\n      };\n    } else if (document.getElementById(props.formId + \"-sq-gift-card\")) {\n      config.giftCard = {\n        elementId: props.formId + \"-sq-gift-card\",\n        placeholder: props.placeholderGiftCard || '• • • •  • • • •  • • • •  • • • •'\n      };\n      config.inputClass = props.inputClass || 'sq-input';\n      config.inputStyles = props.inputStyles;\n    } else {\n      config.inputClass = props.inputClass || 'sq-input';\n      config.inputStyles = props.inputStyles;\n\n      if (document.getElementById(props.formId + \"-sq-apple-pay\")) {\n        config.applePay = {\n          elementId: props.formId + \"-sq-apple-pay\"\n        };\n      }\n\n      if (document.getElementById(props.formId + \"-sq-google-pay\")) {\n        config.googlePay = {\n          elementId: props.formId + \"-sq-google-pay\"\n        };\n      }\n\n      if (document.getElementById(props.formId + \"-sq-masterpass\")) {\n        config.masterpass = {\n          elementId: props.formId + \"-sq-masterpass\"\n        };\n      }\n\n      if (document.getElementById(props.formId + \"-sq-card-number\")) {\n        config.cardNumber = {\n          elementId: props.formId + \"-sq-card-number\",\n          placeholder: props.placeholderCreditCard || '• • • •  • • • •  • • • •  • • • •'\n        };\n      }\n\n      if (document.getElementById(props.formId + \"-sq-cvv\")) {\n        config.cvv = {\n          elementId: props.formId + \"-sq-cvv\",\n          placeholder: props.placeholderCVV || 'CVV '\n        };\n      }\n\n      if (document.getElementById(props.formId + \"-sq-postal-code\")) {\n        config.postalCode = {\n          elementId: props.formId + \"-sq-postal-code\",\n          placeholder: props.placeholderPostal || '12345'\n        };\n      } else {\n        config.postalCode = false;\n      }\n\n      if (document.getElementById(props.formId + \"-sq-expiration-date\")) {\n        config.expirationDate = {\n          elementId: props.formId + \"-sq-expiration-date\",\n          placeholder: props.placeholderExpiration || 'MM/YY'\n        };\n      }\n    }\n\n    return config;\n  }\n\n  function renderSqPaymentForm() {\n    if (!scriptLoaded || paymentForm || errorMessage.length > 0) {\n      return;\n    }\n\n    try {\n      var newPaymentForm = new SqPaymentForm(buildSqPaymentFormConfiguration(props));\n      newPaymentForm.build();\n      setPaymentForm(newPaymentForm);\n    } catch (error) {\n      var errorMesasge = error.message || 'Unable to build Square payment form';\n      setErrorMessage(errorMesasge);\n    }\n  }\n\n  react_1.useEffect(function () {\n    if (!formLoaded || !paymentForm) {\n      return;\n    }\n\n    paymentForm.recalculateSize();\n    props.postalCode && paymentForm.setPostalCode(props.postalCode());\n    props.focusField && paymentForm.focus(props.focusField());\n  }, [formLoaded, paymentForm]);\n  react_1.useEffect(function () {\n    loadSqPaymentFormLibrary(function () {\n      return setScriptLoaded(true);\n    }, function () {\n      return setErrorMessage('Unable to load Square payment library');\n    });\n  }, []);\n  react_1.useEffect(function () {\n    renderSqPaymentForm();\n    return function () {\n      if (paymentForm) {\n        paymentForm.destroy();\n        setPaymentForm(undefined);\n      }\n    };\n  }, [scriptLoaded]);\n  react_1.useEffect(function () {\n    if (!paymentForm || masterpassState !== 'ready') {\n      return;\n    }\n\n    var srcBtn = document.getElementById(props.formId + \"-sq-masterpass\");\n\n    if (!srcBtn) {\n      return;\n    }\n\n    var imageUrl = paymentForm.masterpassImageUrl();\n    srcBtn.style.display = 'inline-block';\n    srcBtn.style.backgroundImage = \"url(\" + imageUrl + \")\";\n  }, [paymentForm, masterpassState]);\n\n  if (errorMessage) {\n    return react_1.default.createElement(\"div\", {\n      className: \"sq-payment-form\"\n    }, react_1.default.createElement(\"div\", {\n      className: \"sq-error-message\"\n    }, errorMessage));\n  }\n\n  var context = {\n    applePayState: applePayState,\n    formId: props.formId,\n    googlePayState: googlePayState,\n    masterpassState: masterpassState,\n    onCreateNonce: createNonce,\n    onVerifyBuyer: verifyBuyer\n  };\n  return react_1.default.createElement(Context_1.default.Provider, {\n    value: context\n  }, react_1.default.createElement(\"div\", {\n    id: props.formId,\n    className: \"sq-payment-form\"\n  }, props.children));\n};\n\nexports.SquarePaymentForm.defaultProps = {\n  apiWrapper: 'reactjs/0.7.2',\n  formId: 'sq-payment-form',\n  inputStyles: [{\n    _mozOsxFontSmoothing: 'grayscale',\n    _webkitFontSmoothing: 'antialiased',\n    backgroundColor: 'transparent',\n    color: '#373F4A',\n    fontFamily: 'Helvetica Neue',\n    fontSize: '16px',\n    lineHeight: '24px',\n    padding: '16px',\n    placeholderColor: '#CCC'\n  }],\n  sandbox: false\n};","map":{"version":3,"sources":["../../src/components/SquarePaymentForm.tsx"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\n    result[\"default\"] = mod;\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar react_1 = __importStar(require(\"react\"));\nvar useDynamicCallback_1 = __importDefault(require(\"../hooks/useDynamicCallback\"));\nvar Context_1 = __importDefault(require(\"./Context\"));\nexports.SquarePaymentForm = function (props) {\n    var _a = react_1.useState('loading'), applePayState = _a[0], setApplePayState = _a[1];\n    var _b = react_1.useState('loading'), googlePayState = _b[0], setGooglePayState = _b[1];\n    var _c = react_1.useState('loading'), masterpassState = _c[0], setMasterpassState = _c[1];\n    var _d = react_1.useState(''), errorMessage = _d[0], setErrorMessage = _d[1];\n    var _e = react_1.useState(false), scriptLoaded = _e[0], setScriptLoaded = _e[1];\n    var _f = react_1.useState(undefined), paymentForm = _f[0], setPaymentForm = _f[1];\n    var _g = react_1.useState(false), formLoaded = _g[0], setFormLoaded = _g[1];\n    function cardNonceResponseReceived(errors, nonce, cardData, billingContact, shippingContact, shippingOption) {\n        if (errors || !props.createVerificationDetails) {\n            props.cardNonceResponseReceived(errors, nonce, cardData, '', billingContact, shippingContact, shippingOption);\n            return;\n        }\n        paymentForm &&\n            paymentForm.verifyBuyer(nonce, props.createVerificationDetails(), function (err, result) {\n                props.cardNonceResponseReceived(err ? [err] : null, nonce, cardData, result ? result.token : undefined, billingContact, shippingContact, shippingOption);\n            });\n    }\n    var cardNonceResponseReceivedCallback = useDynamicCallback_1.default(cardNonceResponseReceived);\n    function createNonce() {\n        paymentForm && paymentForm.requestCardNonce();\n    }\n    function verifyBuyer(source, verificationDetails, callback) {\n        paymentForm && paymentForm.verifyBuyer(source, verificationDetails, callback);\n    }\n    function methodsSupported(methods) {\n        var keys = Object.keys(methods);\n        if (keys.includes('masterpass')) {\n            setMasterpassState(methods.masterpass === true ? 'ready' : 'unavailable');\n        }\n        if (keys.includes('applePay')) {\n            setApplePayState(methods.applePay === true ? 'ready' : 'unavailable');\n        }\n        if (keys.includes('googlePay')) {\n            setGooglePayState(methods.googlePay === true ? 'ready' : 'unavailable');\n        }\n        props.methodsSupported && props.methodsSupported(methods);\n    }\n    var paymentFormLoaded = function () {\n        setFormLoaded(true);\n        props.paymentFormLoaded && props.paymentFormLoaded();\n    };\n    function loadSqPaymentFormLibrary(onSuccess, onError) {\n        if (document.getElementById('sq-payment-form-script') && typeof SqPaymentForm === 'function') {\n            onSuccess && onSuccess();\n            return;\n        }\n        var script = document.createElement('script');\n        script.id = 'sq-payment-form-script';\n        if (props.sandbox) {\n            script.src = 'https://js.squareupsandbox.com/v2/paymentform';\n        }\n        else {\n            script.src = 'https://js.squareup.com/v2/paymentform';\n        }\n        script.onload = function () {\n            onSuccess && onSuccess();\n        };\n        script.onerror = function () {\n            onError && onError();\n        };\n        document.body.appendChild(script);\n    }\n    function buildSqPaymentFormConfiguration(props) {\n        var config = {\n            apiWrapper: props.apiWrapper,\n            applicationId: props.applicationId,\n            autoBuild: false,\n            callbacks: {\n                cardNonceResponseReceived: props.cardNonceResponseReceived ? cardNonceResponseReceivedCallback : null,\n                createPaymentRequest: props.createPaymentRequest,\n                inputEventReceived: props.inputEventReceived,\n                methodsSupported: methodsSupported,\n                paymentFormLoaded: paymentFormLoaded,\n                shippingContactChanged: props.shippingContactChanged,\n                shippingOptionChanged: props.shippingOptionChanged,\n                unsupportedBrowserDetected: props.unsupportedBrowserDetected,\n            },\n            locationId: props.locationId,\n        };\n        if (document.getElementById(props.formId + \"-sq-card\")) {\n            config.card = {\n                elementId: props.formId + \"-sq-card\",\n                inputStyle: props.inputStyles && props.inputStyles[0],\n            };\n        }\n        else if (document.getElementById(props.formId + \"-sq-gift-card\")) {\n            config.giftCard = {\n                elementId: props.formId + \"-sq-gift-card\",\n                placeholder: props.placeholderGiftCard || '• • • •  • • • •  • • • •  • • • •',\n            };\n            config.inputClass = props.inputClass || 'sq-input';\n            config.inputStyles = props.inputStyles;\n        }\n        else {\n            config.inputClass = props.inputClass || 'sq-input';\n            config.inputStyles = props.inputStyles;\n            if (document.getElementById(props.formId + \"-sq-apple-pay\")) {\n                config.applePay = { elementId: props.formId + \"-sq-apple-pay\" };\n            }\n            if (document.getElementById(props.formId + \"-sq-google-pay\")) {\n                config.googlePay = { elementId: props.formId + \"-sq-google-pay\" };\n            }\n            if (document.getElementById(props.formId + \"-sq-masterpass\")) {\n                config.masterpass = { elementId: props.formId + \"-sq-masterpass\" };\n            }\n            if (document.getElementById(props.formId + \"-sq-card-number\")) {\n                config.cardNumber = {\n                    elementId: props.formId + \"-sq-card-number\",\n                    placeholder: props.placeholderCreditCard || '• • • •  • • • •  • • • •  • • • •',\n                };\n            }\n            if (document.getElementById(props.formId + \"-sq-cvv\")) {\n                config.cvv = { elementId: props.formId + \"-sq-cvv\", placeholder: props.placeholderCVV || 'CVV ' };\n            }\n            if (document.getElementById(props.formId + \"-sq-postal-code\")) {\n                config.postalCode = {\n                    elementId: props.formId + \"-sq-postal-code\",\n                    placeholder: props.placeholderPostal || '12345',\n                };\n            }\n            else {\n                config.postalCode = false;\n            }\n            if (document.getElementById(props.formId + \"-sq-expiration-date\")) {\n                config.expirationDate = {\n                    elementId: props.formId + \"-sq-expiration-date\",\n                    placeholder: props.placeholderExpiration || 'MM/YY',\n                };\n            }\n        }\n        return config;\n    }\n    function renderSqPaymentForm() {\n        if (!scriptLoaded || paymentForm || errorMessage.length > 0) {\n            return;\n        }\n        try {\n            var newPaymentForm = new SqPaymentForm(buildSqPaymentFormConfiguration(props));\n            newPaymentForm.build();\n            setPaymentForm(newPaymentForm);\n        }\n        catch (error) {\n            var errorMesasge = error.message || 'Unable to build Square payment form';\n            setErrorMessage(errorMesasge);\n        }\n    }\n    react_1.useEffect(function () {\n        if (!formLoaded || !paymentForm) {\n            return;\n        }\n        paymentForm.recalculateSize();\n        props.postalCode && paymentForm.setPostalCode(props.postalCode());\n        props.focusField && paymentForm.focus(props.focusField());\n    }, [formLoaded, paymentForm]);\n    react_1.useEffect(function () {\n        loadSqPaymentFormLibrary(function () { return setScriptLoaded(true); }, function () { return setErrorMessage('Unable to load Square payment library'); });\n    }, []);\n    react_1.useEffect(function () {\n        renderSqPaymentForm();\n        return function () {\n            if (paymentForm) {\n                paymentForm.destroy();\n                setPaymentForm(undefined);\n            }\n        };\n    }, [scriptLoaded]);\n    react_1.useEffect(function () {\n        if (!paymentForm || masterpassState !== 'ready') {\n            return;\n        }\n        var srcBtn = document.getElementById(props.formId + \"-sq-masterpass\");\n        if (!srcBtn) {\n            return;\n        }\n        var imageUrl = paymentForm.masterpassImageUrl();\n        srcBtn.style.display = 'inline-block';\n        srcBtn.style.backgroundImage = \"url(\" + imageUrl + \")\";\n    }, [paymentForm, masterpassState]);\n    if (errorMessage) {\n        return (react_1.default.createElement(\"div\", { className: \"sq-payment-form\" },\n            react_1.default.createElement(\"div\", { className: \"sq-error-message\" }, errorMessage)));\n    }\n    var context = {\n        applePayState: applePayState,\n        formId: props.formId,\n        googlePayState: googlePayState,\n        masterpassState: masterpassState,\n        onCreateNonce: createNonce,\n        onVerifyBuyer: verifyBuyer,\n    };\n    return (react_1.default.createElement(Context_1.default.Provider, { value: context },\n        react_1.default.createElement(\"div\", { id: props.formId, className: \"sq-payment-form\" }, props.children)));\n};\nexports.SquarePaymentForm.defaultProps = {\n    apiWrapper: 'reactjs/0.7.2',\n    formId: 'sq-payment-form',\n    inputStyles: [\n        {\n            _mozOsxFontSmoothing: 'grayscale',\n            _webkitFontSmoothing: 'antialiased',\n            backgroundColor: 'transparent',\n            color: '#373F4A',\n            fontFamily: 'Helvetica Neue',\n            fontSize: '16px',\n            lineHeight: '24px',\n            padding: '16px',\n            placeholderColor: '#CCC',\n        },\n    ],\n    sandbox: false,\n};\n//# sourceMappingURL=SquarePaymentForm.js.map"]},"metadata":{},"sourceType":"script"}